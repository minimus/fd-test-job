module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("redux")},function(e,t){e.exports=require("react-router-dom")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("react-leaflet-universal")},function(e,t){e.exports=require("react-redux")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("react-dom/server")},function(e,t){e.exports=require("react-router")},function(e,t){e.exports=require("redux-thunk")},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){r(e,t,n[t])})}return e}n.r(t);var i=n(6),a=n.n(i),u=n(3),l=n.n(u),s=n(7),c=n.n(s),d=n(8),p=n.n(d),m=n(9),f=n.n(m),y=n(0),g=n.n(y),h=n(10),b=n.n(h),v=n(1),E=n(5),P=n(2);function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&O(e.prototype,t),n&&O(e,n),e}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e){return(R="function"==typeof Symbol&&"symbol"===_(Symbol.iterator)?function(e){return _(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_(e)})(e)}function k(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}var A=n(11);function N(e){var t=e.id,n=e.title,r=e.value,o=e.handler,i=e.pass,a=void 0!==i&&i?"password":"text";return g.a.createElement("div",{className:"labeled-input"},n,g.a.createElement("input",{id:t,type:a,value:r,onChange:o}))}N.defaultProps={pass:!1};var j=function(e){function t(){return w(this,t),k(this,M(t).apply(this,arguments))}return x(t,y["Component"]),S(t,[{key:"render",value:function(){var e=this.props,t=e.strings.login,n=e.username,r=e.password,o=e.loggedIn,i=e.rememberMe,a=e.trackName,u=e.trackPass,l=e.changeRememberMe,s=e.passwordRecoveryNeeded,c=e.signIn,d=e.signOut;return g.a.createElement("div",{id:"home-component-login"},g.a.createElement("h1",null,t.header),g.a.createElement(N,{handler:a,id:"username",title:t.email,value:n}),g.a.createElement(N,{handler:u,id:"password",title:t.password,value:r,pass:!0}),g.a.createElement("div",null,g.a.createElement("label",{id:"remember-me-label",htmlFor:"remember-me"},g.a.createElement("input",{id:"remember-me",type:"checkbox",checked:i,onClick:l}),t.rememberMe)),g.a.createElement("div",{className:"login-buttons"},g.a.createElement("input",{id:"sign-in",className:"sign-in-button",type:"button",value:o?t.signOut:t.signIn,onClick:o?d:c}),g.a.createElement("input",{id:"recovery",className:"link-button",type:"button",value:t.forgotPass,onClick:s})))}}]),t}(),I=function(e){function t(){return w(this,t),k(this,M(t).apply(this,arguments))}return x(t,y["Component"]),S(t,[{key:"render",value:function(){var e=this.props,t=e.strings.recovery,n=e.username,r=e.trackName,o=e.passwordRecoverySent;return g.a.createElement("div",{id:"home-component-recovery"},g.a.createElement("h1",null,t.header),g.a.createElement(N,{handler:r,id:"username",title:t.email,value:n}),g.a.createElement("p",null,t.help),g.a.createElement("div",{className:"login-buttons"},g.a.createElement("input",{id:"send-request",className:"sign-in-button",type:"button",value:t.sendRequest,onClick:o})))}}]),t}(),T=function(e){function t(){var e,n,r;w(this,t);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return k(r,(n=r=k(this,(e=M(t)).call.apply(e,[this].concat(i))),r.dialogContent=function(){return r.props.recovery?g.a.createElement(I,r.props):g.a.createElement(j,r.props)},n))}return x(t,y["Component"]),S(t,[{key:"render",value:function(){return g.a.createElement("section",{id:"home-component"},this.dialogContent())}}]),t}();function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var D=n(4),H=function(e){function t(){var e,n,r;w(this,t);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return k(r,(n=r=k(this,(e=M(t)).call.apply(e,[this].concat(i))),r.handleViewportChanged=function(e){var t=r.props,n=t.history,o=t.viewportChanged,i=t.currentPosition,a=q(e.center,2),u=a[0],l=a[1];(i.latitude&&i.latitude!==u||i.longitude&&i.longitude!==l)&&n.push("/".concat(u,"/").concat(l)),o(e)},n))}return x(t,y["Component"]),S(t,[{key:"render",value:function(){var e=this.props,t=e.position,n=e.currentPosition,r=(e.locale,e.zoom),o=e.strings,i=t.latitude,a=t.longitude,u=n.latitude,l=n.longitude,s=o.maps.markerPosition;return g.a.createElement("div",{id:"maps"},g.a.createElement(D.Map,{center:[i,a],zoom:r,maxZoom:10,attributionControl:!0,zoomControl:!0,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!0,animate:!0,easeLinearity:.35,style:{width:"100%",height:"100%"},onViewportChanged:this.handleViewportChanged},g.a.createElement(D.TileLayer,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),g.a.createElement(D.Marker,{position:[u,l]},g.a.createElement(D.Popup,null,s))))}}]),t}();function z(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e&&t?7:-1,r=new Date;r.setDate(r.getDate()+n),document.cookie="username=".concat(e,"; expires=").concat(r.toUTCString())}function G(){return{en:{latitude:40.73061,longitude:-73.935242},de:{latitude:52.520008,longitude:13.404954},ru:{latitude:55.751244,longitude:37.618423}}[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en"]}function U(e){var t={en:{maps:{markerPosition:"You are here.",markerNearPosition:"You are here... Maybe..."},login:{header:"Please, log in",email:"E-mail",password:"Password",rememberMe:"Remember Me",signIn:"Sign In",signOut:"Sign Out",forgotPass:"Forgot Password?"},recovery:{header:"Password Recovery",sendRequest:"Send Request",help:'Enter your email and click "Send Request" button. You will be sent a letter with detailed instructions.'}},de:{maps:{markerPosition:"Du bist hier.",markerNearPosition:"Du bist hier... Vielleicht..."},login:{header:"Anmeldung",email:"E-mail",password:"Passwort",rememberMe:"Erinnere dich an mich",signIn:"Einloggen",signOut:"Ausloggen",forgotPass:"Forgot Password?"},recovery:{header:"Passwort-Wiederherstellung",sendRequest:"Anfrage senden",help:'Geben Sie Ihre E-Mail-Adresse ein und klicken Sie auf "Anfrage senden". Sie erhalten einen Brief mit detaillierten Anweisungen.'}},ru:{maps:{markerPosition:"Вы здесь.",markerNearPosition:"Вы здесь... Возможно..."},login:{header:"Авторизация",email:"E-mail",password:"Пароль",rememberMe:"Запомнить меня",signIn:"Вход",signOut:"Выйти",forgotPass:"Забыли пароль?"},recovery:{header:"Восстановление пароля",sendRequest:"Отправить запрос",help:"Введите адрес электронной почты и нажмите кнопку «Отправить запрос». Вам будет отправлено письмо с подробными инструкциями."}}};return/^(en|de|ru)$/.test(e)?t[e]:t.en}var L="HOME_USERNAME_CHANGED",V="HOME_PASSWORD_CHANGED",W="HOME_SIGN_IN",F="HOME_SIGN_OUT",Y="HOME_REMEMBER_ME_CHANGED",B="HOME_PASSWORD_RECOVERY_NEEDED",Z="HOME_PASSWORD_RECOVERY_SENT",J="APPLICATION_GET_USER_PROPERTIES",$="MAP_USER_POSITION_CHANGE_STARTED",K="MAP_USER_POSITION_CHANGE_FINISHED",Q="MAP_USER_POSITION_CHANGE_ERROR",X="MAP_VIEWPORT_CHANGED";var ee={username:"",password:"",rememberMe:!1,recovery:!1,locale:"en",position:G("en"),currentPosition:G("en"),storedPosition:{stored:!1,latitude:null,longitude:null},zoom:9,strings:U("en"),loggedIn:!1};var te=function(e){function t(){return w(this,t),k(this,M(t).apply(this,arguments))}return x(t,y["Component"]),S(t,[{key:"componentDidMount",value:function(){this.props.changeUserPosition()}},{key:"render",value:function(){return g.a.createElement("div",{id:"home-container"},g.a.createElement(H,this.props),g.a.createElement(T,this.props))}}]),t}(),ne={trackName:function(e){return function(t){var n=e.target.value;t({type:L,payload:n})}},trackPass:function(e){return function(t){var n=e.target.value;t({type:V,payload:n})}},getUserProperties:function(){return function(e){e({type:J,payload:{}})}},changeUserPosition:function(){return function(e){e({type:$,payload:!0}),setTimeout(function(){(function(e){if(window)return new Promise(function(t,n){return window.navigator.geolocation.getCurrentPosition(t,n,e)})})({enableHighAccuracy:!1,timeout:5e3,maximumAge:0}).then(function(t){var n=t.coords,r=n.latitude,o=n.longitude;e({type:K,payload:{latitude:r,longitude:o}})}).catch(function(t){e({type:Q,payload:t})})},1500)}},viewportChanged:function(e){return function(t){var n=q(e.center,2),r=n[0],o=n[1],i=e.zoom;t({type:X,payload:{position:{latitude:r,longitude:o},zoom:i}})}},changeRememberMe:function(e){return function(t){t({type:Y,payload:e.target.checked})}},passwordRecoveryNeeded:function(){return function(e){e({type:B,payload:!0})}},passwordRecoverySent:function(){return function(e){e({type:Z,payload:!1})}},signIn:function(){return function(e){e({type:W,payload:!0})}},signOut:function(){return function(e){e({type:F,payload:!1})}}},re=Object(E.connect)(function(e){return{locale:e.home.locale,position:e.home.position,currentPosition:e.home.currentPosition,zoom:e.home.zoom,strings:e.home.strings,username:e.home.username,password:e.home.password,rememberMe:e.home.rememberMe,recovery:e.home.recovery,loggedIn:e.home.loggedIn}},ne)(Object(A.withRouter)(te)),oe=function(e){function t(){return w(this,t),k(this,M(t).apply(this,arguments))}return x(t,y["Component"]),S(t,[{key:"render",value:function(){return g.a.createElement("article",{id:"main"},g.a.createElement(P.Switch,null,g.a.createElement(P.Route,{path:"/",component:re}),g.a.createElement(P.Route,{path:"/:latitude/:longitude",component:re})))}}]),t}(),ie=n(12),ae=n.n(ie),ue=(Object(v.applyMiddleware)(ae.a)(v.createStore),Object(v.combineReducers)({home:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $:return e;case K:var n=e.storedPosition;return o({},e,{position:n.stored?{latitude:n.latitude,longitude:n.longitude}:t.payload,currentPosition:o({},t.payload),zoom:10});case Q:var r=e.storedPosition,i=G(e.locale);return o({},e,{position:r.stored?{latitude:r.latitude,longitude:r.longitude}:i,currentPosition:o({},i),zoom:10});case X:return o({},e,t.payload);case L:return o({},e,{username:t.payload});case V:return o({},e,{password:t.payload});case W:return z(e.username,e.rememberMe),o({},e,{loggedIn:t.payload});case F:return z(e.username,!1),o({},e,{loggedIn:t.payload});case Y:return o({},e,{rememberMe:t.payload});case B:case Z:return o({},e,{recovery:t.payload});default:return e}}})),le=l()();le.use(f()());function se(e,t){var n=e.get("Accept-Language"),r=n?function(e){if(e){var t=e.split(",")[0];if(/^(ru|en|de)/gi.test(t))return t.split("-")[0].toLowerCase()}else if(window)return/^(ru|de|en)/gi.test(window.navigator.language)?window.navigator.language.split("-")[0].toLowerCase():"en";return"en"}(n.split(",")[0]):"en",i=G(r),a=U(r),u=e.params,l=u.latitude,s=u.longitude,c={latitude:parseFloat(l),longitude:parseFloat(s),stored:!!l&&!!s},d=e.cookies.username,p=void 0===d?"":d,m=!!p,f=Object(v.createStore)(ue),y=b.a.renderToString(g.a.createElement(E.Provider,{store:f},g.a.createElement(P.StaticRouter,{location:e.url,context:{}},g.a.createElement(oe,null)))),h=f.getState(),w=o({},h,{home:o({},h.home,{locale:r,position:i,storedPosition:c,strings:a,username:p,rememberMe:m})});t.send(function(e,t){var n=t.home.locale;return'\n    <!doctype html>\n    <html lang="'.concat(n,'">\n      <head>\n        <title>TheBoats.com test job</title>\n        <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,400,400i,700,700i&subset=cyrillic" rel="stylesheet">\n        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css">\n        <link href="/css/style.css" rel="stylesheet">\n      </head>\n      <body>\n        <div id="app">').concat(e,"</div>\n        <script>\n          window.__PRELOADED_STATE__ = ").concat(JSON.stringify(t).replace(/</g,"\\u003c"),'\n        <\/script>\n        <script src="/js/bundle.js"><\/script>\n      </body>\n    </html>\n    ')}(y,w))}le.use(l.a.json()),le.use(l.a.urlencoded({extended:!1})),le.use(c()()),le.use(p()()),le.use(l.a.static(a.a.join("./","public"))),process.env.BROWSER=!1,le.use("/:latitude/:longitude",se),le.use("/",se),le.listen(3e3)}]);
//# sourceMappingURL=server.js.map